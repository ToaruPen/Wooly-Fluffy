# データ方針 / 記憶モデル

## データ最小化（決定）

- `ROOM` の会話は**永続保存しない**
- 必要があって短期保持する場合も「一定時間後にセッション削除」を前提にする
- 音声（録音ファイル）は保存しない
- STTの全文テキストも原則は保存しない（保存するのは“記憶”として最小化した要約のみ）

## 短期セッション保持（決定）

- `ROOM` の会話コンテキストは短期のみ（必要ならRAMで保持し、ディスクには残さない）
- 保持時間は `3分`（以降は破棄する）

## MVPでディスクに保存するもの（決定）

- `PERSONAL` の `pending`（子どもが「はい」と言った候補。職員Confirm待ち）
- `PERSONAL` の `confirmed`（職員が Confirm した“想起対象”。低センシティブのみ）

## （後続）ディスクに保存するもの（保留）

- `ROOM` の「みんなの思い出」（日付単位 / 個人特定なし）
  - 会話体験（LLM/フォールバック/ログ最小化等）が固まってから段階導入する

### 低センシティブ（ホワイトリスト例・決定）
- 好きなこと
- 好きな食べ物
- 好きな遊び
- いまハマっていること

### `ROOM`（みんなの思い出 / 後続・保留）
- 日付（`YYYY/MM/DD`）単位で保存する
- 内容は出来事・活動の要約のみ（個人名や個人が特定できる情報は入れない）

## 保存しない（強い方針）

- ルーム雑談の全文ログ
- カメラ映像/画像の保存（将来カメラを使う場合も、フレームはローカル処理して破棄する）
- カメラから得た推定シグナル（人数/雰囲気など）の永続保存（必要なら「遅延/成功率」等の本文無しメトリクスのみ）
- センシティブ情報（健康/家庭/トラブル等に繋がる可能性があるもの）
- “推測”での事実確定（例: 「テストがあった」→点数や結果を断定しない）
- （必要がある場合でも）会話全文の保存はせず、せいぜい短い `source_quote` 程度に留める

## `pending` / `confirmed` / TTL（決定）

- `pending`: 子どもが「はい」と言った候補（職員の確認待ち）
  - `expires_at=24h`（期限切れは自動で忘却/削除）
- `confirmed`: 職員が Confirm した“想起対象”
  - デフォルトは自動忘却しない（`expires_at=NULL`）
  - 必要なら個別に `expires_at` を設定して忘れさせる
- `rejected`: 子どもが「いいえ」と言った／職員が Deny した候補（想起しない）

## 簡易データモデル案（叩き台）

> 実装前のたたき台。最小から始めて増やす。

- `children`
  - `id`（内部ID）
  - `display_name`（呼び名。実名は避けられるなら避ける。MVPではユニーク運用）
  - `nfc_uid_hash`（将来用。生UID直保存は避ける方向）
  - `created_at`
- `memory_items`
  - `id`
  - `scope`（`personal` / `room`）
  - `child_id`（`scope=personal` の場合のみ）
  - `room_day`（`scope=room` の場合のみ。`YYYY-MM-DD` 等）
  - `kind`（likes/food/play/hobby 等）
  - `value`（短い要約）
  - `source_quote`（任意。短い引用。全文ログは保存しない）
  - `child_preference`（yes/no/unknown。子どもの返答）
  - `status`（pending/confirmed/rejected/deleted）
  - `created_at`
  - `expires_at`（TTL）

## 未確定

- 削除要求や運用手順（誰がどう消すか）
- `ROOM` の「みんなの思い出」の保持期間（年度/学期単位で棚卸しするか、期限を決めるか）

## バックアップ（方針）

- 正（SoT）はローカルSQLite（同期の“正”をクラウドに置かない）
- 端末故障に備えて、`confirmed`（低センシティブのみ）は、暗号化したバックアップをクラウドへ退避してよい（同期ではなく片方向スナップショット）
- （後続）`ROOM` の「みんなの思い出」を導入する場合も、暗号化したバックアップをクラウドへ退避してよい（同期ではなく片方向スナップショット）
- 同期ズレを避けるため、アプリは稼働中にクラウド側を参照しない（復旧時のみ「スナップショットを手順に従って戻す」）
- バックアップには音声/STT全文/会話全文ログは含めない

### バックアップに関する未確定

- バックアップ先（Google Drive / S3 等）
- 保持期間（世代数/日数）
- 削除要求への対応範囲（稼働DBのみ／バックアップも含める）と手順
- Time Machine等の端末バックアップを使う場合の扱い（削除と整合する運用）
