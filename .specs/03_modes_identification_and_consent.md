# モード設計 / 識別 / 同意フロー

## 入力UX（決定）

- デフォルトは待機（反応しない）
- Push-to-talk（PTT）中だけ収録/認識する（待機時は無反応）
- PTT操作は **STAFF 側が行う**（基本はSTAFF画面のホットキーで hold-to-talk、画面ボタンはフォールバック）
  - MVPのホットキーは `Space` 長押し
  - KIOSK側は子どもの入力で収録/送信を開始しない（責任の所在を職員側へ寄せる）

## Webカメラ（非言語シグナル / 決定）

- Webカメラは **デフォルトOFF**（STAFF 側が ON にした時だけ稼働）
  - KIOSK側は子どもの入力でカメラをONにしない（責任の所在を職員側へ寄せる）
  - ON中のフレームはローカル処理して破棄。保存しない・外部送信しない
- 個人識別はしない（顔認証/個人ID付与はしない）。使うのは非識別のシグナルのみ（例: 顔の位置＝注視点、表情の粗い分類）
- STAFF UI には映像/画像のプレビューを出さない（運用上は「シグナル」のみ扱う）
- 物理的に遮断できる（プライバシーシャッター/カバー等）構成で運用する（ソフトOFFだけに依存しない）
- KIOSK 画面に「カメラ稼働中」を表示し、STAFF 側から ON/OFF できる（緊急停止）
- 画像/シグナルの保存方針は `.specs/04_data_policy_and_memory_model.md` を正とする

## モード（決定）

### `ROOM`（デフォルト）
- 全体向けの雑談モード
- 個人紐付けの記憶保存はしない
- 会話コンテキストは短期のみ（一定時間で破棄）

### `PERSONAL(name)`（音声で名乗って開始 / MVP）
- 音声で `「パーソナル、<name>」` と言ったら、その子のパーソナル会話モードに入る
  - STTの表記揺れ（`、` / `,` / 空白）は許容し、正規化して決定的に解釈する（LLMに任せない）
  - `name` が欠けている場合は不成立とする
  - コマンドは正規化後の先頭一致のみで判定する（部分一致はしない）
- `name`（呼び名）はユニーク運用（同名が出たら別の呼び名にしてもらう）
- 無操作 `3分` で自動的に `ROOM` に戻る
  - `無操作` は「最後の操作」から `300秒` とする
  - `最後の操作` は `PTT終了（離した）` / `はい` / `いいえ` / `ROOMへ戻す` のいずれか
- タイムアウトを“明示アナウンスしない”（自然に `ROOM` に戻る）
- 明示終了: `「ルーム」` または `「ルームに戻る」` 発話（追加語を含む場合はコマンドとして扱わない）/ 職員UIの「ROOMへ戻す」

### `PERSONAL(child)`（NFCで開始 / 将来）
- 子どもがNFCをタッチしたら、その子のパーソナル会話モードに入る
- MVPの `PERSONAL(name)` を置き換える

## 記憶保存の同意（決定）

- パーソナル中に「覚えていい？」の形で確認を取る
- 「覚えていい？」の待ち時間は `30秒` とする（無回答/聞き取れない場合を含む）
  - `30秒` 超過で「さっきのことは忘れるね」と返し、候補は破棄する（`pending` にしない／職員UIにも載せない）
- 子どもが「いいえ」なら保存しない（候補は破棄し、職員UIにも載せない）
- 子どもが「はい」なら職員UIに確認依頼（`pending`）を積み、**職員の Confirm が来た時だけ**DBへ保存（`confirmed`）する
- 記憶対象は低センシティブのホワイトリストに限定する
  - `はい/いいえ` の意図解釈は `InnerTaskProvider` によるスキーマ固定のJSON出力とし、コード側で検証して採用する（外側LLMに任せない）
    - 最小スキーマ: `{"task":"consent_decision","answer":"yes"|"no"|"unknown"}`
    - JSON検証に失敗、または `InnerTaskProvider` がタイムアウト/失敗した場合は `unknown` として扱う

### 補助UI（推奨）

- 「はい/いいえ」は画面ボタンでも入力できるようにする（STT誤認対策）

## 想起（思い出し）のルール（決定）

- 原則 `PERSONAL(...)` の間だけ行う
- 内容は低センシティブのみ（好きなこと/食べ物/遊び/ハマり など）
- `confirmed` のみ参照する

## 補足（MVPの割り切り）

- 話者の“本人確認”はしない（なりすまし対策は「同名禁止（ニックネーム）」と「記憶の最終確定を職員が行う」で守る）
- B（NFC導入）では `PERSONAL(child)` の開始・確認フローを差し替える
