# Research (Estimation): issue-83

> このテンプレートは `/research estimation` コマンドで使用されます。
> 成果物は `docs/research/estimation/issue-<n>/<YYYY-MM-DD>.md` に保存します。

---

## メタ情報

- 作成日: 2026-02-18
- 作成者: @opencode
- 対象: 見積もり前調査
- Issue: #83 feat: 意思決定ログの長期再現性強化（Decision Snapshot運用）

---

## 1. 調査の目的

Issue #83 の Phase 1（非干渉導入）に対して、既存の SoT/DoD/final-review と矛盾しない最小変更面積で Decision Snapshot 運用を導入するため、変更対象、見積もり不確実性、検証観点を事前固定する。

---

## 2. 新規性判定（発火条件）

- 直接の先行事例が2件未満: Yes
- PRD/Epic/Issue に Unknown/曖昧さが残る: Yes
- Q6-5〜8（PII/監査/性能/可用性）のいずれかが Yes: No

---

## 3. 候補（必須: >= 5）

候補-1
概要: `docs/decisions.md` を「index + 運用ルール」へ再編し、1決定=1ファイル方針を明記する
適用可否: Yes
根拠リンク:
- https://openai.com/index/harness-engineering/
- https://cookbook.openai.com/articles/codex_exec_plans
捨て条件:
- 既存の ADR 本文を同一ファイル継続運用する方針が明示された場合
リスク/検証:
- リスク: 既存サンプルとの重複で index の責務が曖昧化
- 検証方法: `docs/decisions.md` に本文を残さず索引責務へ限定できているかレビュー

候補-2
概要: `docs/decisions/` ディレクトリを新設し、Decision Snapshot テンプレートを追加する
適用可否: Yes
根拠リンク:
- https://martinfowler.com/articles/architecture-decision-records.html
- https://adr.github.io/
捨て条件:
- 「1決定=1ファイル」運用自体を採用しないと決まった場合
リスク/検証:
- リスク: フォーマット必須項目が不足し再現不能
- 検証方法: Decision-ID / Context / Rationale / Alternatives / Impact / Verification / Supersedes / Inputs Fingerprint の全項目をテンプレートに含める

候補-3
概要: `docs/sot/README.md` に Decision Snapshot 導線を追加し SoT 上の位置づけを固定する
適用可否: Yes
根拠リンク:
- https://openai.com/index/harness-engineering/
- https://martinfowler.com/bliki/BoundedContext.html
捨て条件:
- SoT index から意思決定記録を除外する明示方針がある場合
リスク/検証:
- リスク: SoT index が肥大し map-not-manual 原則を損なう
- 検証方法: 詳細本文を置かず導線のみ追加していることを確認

候補-4
概要: `.agent/rules/dod.md` と `.agent/rules/docs-sync.md` に Decision 確認観点を追加する
適用可否: Yes
根拠リンク:
- https://docs.github.com/en/issues/tracking-your-work-with-issues/about-issues
- https://www.atlassian.com/continuous-delivery/principles/workflows-with-feature-branching-and-gitflow
捨て条件:
- Gate 追加で既存 fail-closed が弱まる、または過剰強制になる場合
リスク/検証:
- リスク: ルールが曖昧でレビュー実行者ごとに判定が揺れる
- 検証方法: DoD と docs-sync の両方に「確認対象」「参照先」を具体記載

候補-5
概要: `.agent/commands/final-review.md` に Decision 確認手順を追加し最終レビュー動線を統一する
適用可否: Yes
根拠リンク:
- https://openai.com/index/harness-engineering/
- https://cookbook.openai.com/articles/codex_exec_plans
捨て条件:
- /final-review のスコープを変更しない方針が明示された場合
リスク/検証:
- リスク: AC 検証と Decision 検証の責務重複
- 検証方法: 既存フェーズ構成を壊さずに追加観点として挿入する

候補-6
概要: append-only + supersede 運用を明文化し、同一 Decision の上書きを禁止する
適用可否: Yes
根拠リンク:
- https://git-scm.com/docs/git-notes
- https://martinfowler.com/articles/architecture-decision-records.html
捨て条件:
- 「上書き更新を許容する」運用が別Issueで正式決定された場合
リスク/検証:
- リスク: 命名規約未定義で supersede 関係が追跡不能
- 検証方法: Supersedes 項目を必須化し、置換時は新規ファイル作成をルール化

---

## 4. 隣接領域探索（新規性が高い場合は必須）

隣接領域-1
概要: ADR（Architecture Decision Record）の長期保守運用
根拠リンク:
- https://adr.github.io/
- https://martinfowler.com/articles/architecture-decision-records.html

隣接領域-2
概要: AIエージェント向け repository-as-context（SoR/SoT）設計
根拠リンク:
- https://openai.com/index/harness-engineering/
- https://cookbook.openai.com/articles/codex_exec_plans

抽象化-1
原理/パターン: append-only で履歴改ざんリスクを下げる

抽象化-2
原理/パターン: index と本文を分離し、探索コストと責務を固定する

抽象化-3
原理/パターン: review gate で「存在確認」と「再現可能性確認」を分離する

適用マッピング
- PRD: FR-5（progress/decision log テンプレ）の実装方針を明確化
- Epic: docs/rules/commands の最小変更で導入する設計判断に反映
- Estimation: 変更対象ファイル・確認手順・不確実性（命名規約/supersede運用）を先に固定

---

## 5. 止め時（必須）

タイムボックス: 60min
打ち切り条件:
- docs/rules/commands での変更対象が 6 ファイル以内に収束した
- Decision テンプレの必須項目と検証観点を列挙できた
- 非目標（`scripts/review-cycle.sh` と `scripts/tests/test-review-cycle.sh` 非改修）を維持できる見通しが立った

---

## 6. 見積もりへの反映サマリ

- 不確実性/リスク: 先行事例が少なく、Decision-ID 命名規約と supersede 運用粒度が実装時にぶれやすい
- 調査で減った不確実性: 変更面を docs/rules/commands に限定し、必須項目と gate 追記箇所を固定できた
- テスト計画への影響: 実装時はドキュメントlint・リンク整合・DoD/final-review の観点追加を中心に検証する
