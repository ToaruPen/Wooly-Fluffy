# PRD: Webカメラ状況認識（非識別ムード）

---

## メタ情報

- 作成日: 2026-02-07
- 作成者: -
- ステータス: Draft
- バージョン: 1.0

---

## 1. 目的・背景

Wooly-Fluffy のKIOSK体験を「会話（音声）」だけに依存させず、目の前の場の雰囲気に合わせた非言語リアクション（表情・モーション）で“雰囲気づくり”を補強したい。
ただし、未成年が主対象となり得るため、映像の保存や個人識別は行わず、デフォルトOFFでローカル処理に限定する。

---

## 2. 7つの質問への回答

### Q1: 解決したい問題は？

KIOSKのマスコットが「目の前に人がいる/いない」や「場の雰囲気（例: 笑顔っぽい）」に反応できないと、体験が硬くなりやすい。
一方で、カメラ映像はセンシティブであり、保存・外部送信・個人識別を伴う設計は運用上のリスクが大きい。

### Q2: 誰が使う？

- 子ども（KIOSK画面の利用者。操作は最小）
- 職員（運用上の責任者。STAFF画面から機能ON/OFFを行う）

### Q3: 何ができるようになる？

- デフォルトOFFの状態から、職員がSTAFF画面で「状況認識（Webカメラ）」を有効化/無効化できる
- 有効化中、KIOSKがローカル推論で粗いムード（`happy|neutral|unknown`）を推定し、表情・モーションに反映できる
- 推定結果を根拠に感情を断定する発話はしない（非言語リアクションに限定）

### Q4: 完成と言える状態は？

- 職員がSTAFF画面でON/OFFでき、KIOSKに反映される
- 有効化時のみカメラが稼働し、無効時はカメラが稼働しない（MediaStream track の停止が保証される）
- KIOSKは映像プレビューを表示しない
- KIOSKは「カメラ有効」を示すインジケータを表示できる（プレビューは出さない）
- 保存・ログを行わず、粗いムード信号のみをKIOSK内部で使用して表情・モーションが変化する
- カメラが利用不可（権限拒否/未対応/エラー）の場合でも、KIOSKは破綻せず従来どおり動作する（フォールバック: neutral + モーションなし）
- サーバ再起動時は、Vision機能は安全側（OFF）に戻る
- STAFFセッションが失効/自動ロックした場合、Vision機能は安全側（OFF）に戻る

### Q5: 作らない範囲は？

- 個人識別（顔認証/個人ID付与/長期追跡）
- 画像/動画のディスク保存、推論結果の永続保存
- 推論結果を根拠にした断定発話（例: 「今、笑ってるね」）
- クラウドへの映像送信（必要になった場合は別途仕様化して合意する）

### Q6: 技術的制約は？

Q6-1: 既存言語/フレームワーク固定
選択: Yes
詳細（Yesの場合）: TypeScript（Node.js LTS）+ React（Vite）

Q6-2: デプロイ先固定
選択: Yes
詳細（Yesの場合）: 常設PC上でローカル稼働（単一KIOSK想定）

Q6-3: 期限
選択: Unknown
詳細（日付の場合）: -

Q6-4: 予算上限
選択: ない
詳細（あるの場合）: -

Q6-5: 個人情報/機密データ
選択: Yes
詳細（Yesの場合）: 映像入力はセンシティブなため、保存しない・ログに出さない・外部送信しない・個人識別しないを必須とする。派生データは粗いムード（`happy|neutral|unknown`）など最小限に限定し、永続保存しない。

Q6-6: 監査ログ要件
選択: No
詳細（Yesの場合）: -

Q6-7: パフォーマンス要件
選択: No
詳細（Yesの場合）: -

Q6-8: 可用性要件
選択: No
詳細（Yesの場合）: -

### Q7: 成功指標（測り方）は？

指標-1
指標: データ最小化（保存/ログ）を破らない
目標値: 画像/動画/推論結果が永続化されず、ログにも出力されない
測定方法: 実装レビュー + テスト（カメラOFF時にトラック停止されること、ログ出力が無いこと）

指標-2
指標: 非言語リアクションの安定性
目標値: ムード推定の揺れで表情/モーションが毎フレーム切り替わらない（平滑化・ヒステリシスで抑制）
測定方法: ユニットテスト（状態推定ロジック）+ 手動スモーク（KIOSKでの体感）

---

## 3. ユーザーストーリー

### US-1: 子どもが“雰囲気”を感じられる

```
As a 子ども,
I want to KIOSKのマスコットが場の雰囲気に合わせて表情やしぐさを変える,
So that 話しかけやすく、体験が柔らかくなる.
```

### US-2: 職員が運用上のリスクを制御できる

```
As a 職員,
I want to カメラ機能をデフォルトOFFにし、必要なときだけONにできる,
So that プライバシー/運用リスクを最小化できる.
```

---

## 4. 機能要件

FR-1
機能名: Vision機能（状況認識）のデフォルトOFF
説明: デフォルトではカメラを使用しない。職員がSTAFF画面からON/OFFでき、KIOSKからはONにできない。
優先度: Must

FR-4
機能名: STAFF UI（運用/設定）でのVision操作
説明: Vision操作はSTAFFの運用/設定セクションに配置し、ONにする際は確認ダイアログを必須とする。ON中は状態（例: `VISION: ON`）が常時可視で、OFF操作がすぐできる。
優先度: Must

FR-2
機能名: ムード推定（粗い分類）
説明: ローカル推論で `mood=happy|neutral|unknown` を推定し、揺れを平滑化・ヒステリシスで抑制する。
優先度: Must

FR-3
機能名: 非言語リアクション
説明: ムード推定を表情・モーションに反映する（発話は行わない）。
優先度: Must

---

## 5. 受け入れ条件（AC）

### 正常系

- [ ] AC-1: Vision機能がOFFのとき、カメラ（MediaStream track）が開始されず、開始済みの場合は停止される（停止は2秒以内）
- [ ] AC-2: 職員がSTAFF画面でVision機能をONにすると、KIOSKがカメラを開始しムード推定を行う
- [ ] AC-3: 職員がSTAFF画面でVision機能をOFFにすると、KIOSKがカメラを停止しムード推定を停止する
- [ ] AC-4: Vision機能がONのとき、KIOSKは映像プレビューを表示せずにムード推定を行い、表情/モーションが更新される
- [ ] AC-5: ムード推定の入力が揺れても、表情/モーションが毎フレーム切り替わらない（平滑化/ヒステリシスが効いている）
- [ ] AC-6: VisionをONにする操作は、STAFFの運用/設定セクションにあり、確認ダイアログを経由しないとONにならない
- [ ] AC-7: VisionがONの間、STAFF画面に `VISION: ON` のような状態表示が常時可視で、OFF操作がすぐできる

### 異常系（必須: 最低1つ）

- [ ] AC-E1: カメラが利用できない（権限拒否/未対応/エラー）場合でも、KIOSKはエラーで停止せずフォールバック（neutral + モーションなし）で動作する
- [ ] AC-E2: サーバ再起動時、Vision機能はOFFとして扱われ、KIOSKはカメラを開始しない
- [ ] AC-E3: STAFFセッションが失効/自動ロックした場合、Vision機能はOFFとして扱われ、KIOSKはカメラを停止する

---

## 6. 非機能要件（該当する場合）

- パフォーマンス: N/A（本PRDでは数値目標を置かない）
- 可用性: N/A（単機ローカル運用を前提）
- セキュリティ: 映像/推論結果を保存しない・ログに出さない・外部送信しない・個人識別しない。デフォルトOFF。
- その他: 推定結果を根拠に感情を断定する発話はしない

---

## 7. 規模感と技術方針

- 規模感: 小規模
- 技術方針: シンプル優先

---

## 8. 用語集

用語-1
用語: ムード（mood）
定義: 個人を特定しない粗い雰囲気推定。値は `happy|neutral|unknown` に限定し、永続保存しない。

---

## 変更履歴

- 2026-02-07: v1.0 初版作成
