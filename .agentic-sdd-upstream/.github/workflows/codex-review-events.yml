name: codex-review-events

on:
  issue_comment:
    types: [created]
  pull_request_review:
    types: [submitted]
  pull_request_review_comment:
    types: [created]

permissions:
  contents: read
  issues: read
  pull-requests: read

jobs:
  codex-review-events:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Ensure gh is available
        shell: bash
        run: |
          set -euo pipefail
          if ! command -v gh >/dev/null 2>&1; then
            echo "[codex-review-event] error: gh is required" >&2
            exit 1
          fi

      - name: Normalize and log Codex/Coderabbit events
        shell: bash
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          CODEX_BOT_LOGINS: ${{ vars.CODEX_BOT_LOGINS }}
          CODEX_REVIEW_REQUIRE_GH_AUTH: "1"
        run: |
          set -euo pipefail
          : "${CODEX_BOT_LOGINS:?Set repository variable CODEX_BOT_LOGINS}"
          bash ./scripts/codex-review-event.sh
